{% extends base_template_name|default:"base.html" %}

{# Demo B: "Runs First" #}
{# Weekly runs get top billing right after carousel #}

{% load blog_tags %}
{% load cache %}
{% load core_tags %}
{% load heroicons %}
{% load markdownify %}
{% load news_tags %}
{% load race_tags %}
{% load run_tags %}
{% load sponsors_tags %}
{% load static %}
{% load thumbor_tags %}


{% block content %}
    {# Photo Carousel #}
    <section class="w-full">
        {% include 'includes/_carousel.html' %}
    </section>

    {# Weekly Runs - Prominent Full Width #}
    <section id="weekly-runs" class="bg-gradient-to-r from-red-50 to-yellow-50 -mx-4 md:-mx-6 px-4 md:px-6 py-8 rounded-lg">
        <h2 class="font-bold text-2xl md:text-3xl pb-4 text-red-900">Run With Us</h2>
        <p class="text-gray-600 mb-6">Join our weekly group runs - all skill levels welcome!</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            {% for run in runs %}
                {% include 'includes/_run_card.html' with run=run %}
            {% empty %}
                <p class="text-gray-500 col-span-full">No weekly runs scheduled.</p>
            {% endfor %}
        </div>
        <a class="inline-block mt-6 py-2 px-6 font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors" href="{% url 'run_list' %}">
            View run details <i class="fa fa-arrow-right ml-1"></i>
        </a>
    </section>

    {# Upcoming Races Grid #}
    <section id="upcoming-races">
        <h2 class="font-bold text-2xl md:text-3xl pb-4">Upcoming Races</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
            {% get_latest_races as races %}
            {% for race in races %}
                {% include 'includes/_race.html' with race=race %}
            {% empty %}
                <p class="text-gray-500 col-span-full">No upcoming races scheduled.</p>
            {% endfor %}
        </div>
        <a class="inline-block mt-4 py-2 px-4 text-sm font-medium text-red-600 hover:text-red-800 transition-colors" href="{% url 'race_index' %}">
            View all races <i class="fa fa-arrow-right ml-1"></i>
        </a>
    </section>

    {# Recent News - Two Column List #}
    <section id="recent-news">
        <h2 class="font-bold text-2xl md:text-3xl pb-4">Recent News</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% get_latest_news num=4 as latest_news %}
            {% for news in latest_news %}
                <article class="flex gap-4 p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex-shrink-0 w-16 text-center">
                        <span class="block text-2xl font-bold text-red-600">{{ news.pub_date|date:"j" }}</span>
                        <span class="block text-sm text-gray-500 uppercase">{{ news.pub_date|date:"M" }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        {% if news.title %}
                            <h4 class="font-bold text-gray-900 mb-1 truncate">{{ news.title }}</h4>
                        {% endif %}
                        <div class="prose prose-sm text-gray-600 line-clamp-2">
                            {{ news.body|markdownify|truncatewords_html:25 }}
                        </div>
                    </div>
                </article>
            {% empty %}
                <p class="text-gray-500 col-span-full">No recent news.</p>
            {% endfor %}
        </div>
        <a class="inline-block mt-4 py-2 px-4 text-sm font-medium text-red-600 hover:text-red-800 transition-colors" href="{% url 'news_list' %}">
            View all news <i class="fa fa-arrow-right ml-1"></i>
        </a>
    </section>

    {# Sponsors #}
    {% get_homepage_sponsors as homepage_sponsors %}
    {% if homepage_sponsors %}
        <section id="sponsors">
            <h2 class="font-bold text-2xl md:text-3xl pb-4">Sponsors</h2>
            <div class="flex flex-wrap -mx-2">
                {% for sponsor in homepage_sponsors %}
                    {% include 'includes/_sponsor.html' with sponsor=sponsor %}
                {% endfor %}
            </div>
        </section>
    {% endif %}
{% endblock content %}
