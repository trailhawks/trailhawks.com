{% extends base_template_name|default:"base.html" %}



{% load core_tags %}
{% load faq_tags %}
{% load links_tags %}
{% load markdownify %}
{% load news_tags %}
{% load race_tags %}
{% load share_tags %}
{% load simple_open_graph %}
{% load sponsors_tags %}
{% load static %}
{% load thumbor_tags %}


{% block title %}{{ object.title }}{% if object.get_overall_results %} Results{% endif %}{% endblock title %}


{% block opengraph %}
    {% with object.description|markdownify|striptags|truncatechars:300 as og_description %}
        {% if object.logo %}
            {% opengraph_meta "type='article', url=object.get_absolute_url, title=object.title, image=object.logo.url, description=og_description" %}
        {% else %}
            {% opengraph_meta "type='article', url=object.get_absolute_url, title=object.title, image='https://trailhawks.com/static/img/hawk-head.png', description=og_description" %}
        {% endif %}
    {% endwith %}
{% endblock opengraph %}


{% block post_script %}
    <script>
        {% if object.location %}
            function initialize() {
                var myLatlng = new google.maps.LatLng({{ object.location.latitude }}, {{ object.location.longitude }});

                var mapOptions = {
                    center: myLatlng,
                    zoom: {{ object.location.zoom }}
                };

                var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    title: 'Hello World!'
                });
            }
            google.maps.event.addDomListener(window, 'load', initialize);
        {% endif %}

        ZeroClipboard.config({ moviePath: "{% static 'js/ZeroClipboard.swf' %}" });

        var client = new ZeroClipboard( document.getElementById("copy-button"));

        client.on("ready", function( readyEvent ) {
            client.on("aftercopy", function(event) {
                // `this` === `client`
                // `event.target` === the element that was clicked
                event.target.style.display = "none";
                alert("Copied text to clipboard: " + event.data["text/plain"]);
            });
        });
    </script>
{% endblock post_script %}


{% block content %}
    {% get_race_types_for_race object as race_types %}

    <header class="masthead">
        <h1 class="font-bold text-3xl sm:text-4xl md:text-6xl py-4">{{ object.title }}</h1>
        {% if object.slogan %}
            <h2 class="font-bold text-xl sm:text-2xl py-2">{{ object.slogan }}</h2>
        {% endif %}
    </header>

    <div class="flex flex-col md:flex-row gap-8">
        <div class="w-full md:w-2/3 flex flex-col gap-8">

            {% if object.logo %}
                <img class="w-full h-auto object-contain max-h-80" src="{{ object.logo.url }}" alt="{{ object.title }} logo">
            {% endif %}

            {% if not object.is_finished %}
                {% if object.registration_set.exists %}
                    <div class="mb-4">
                        {# Desktop table view #}
                        <div class="hidden md:block overflow-x-auto">
                            <table class="w-full min-w-full bg-transparent table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th class="px-2 py-2 text-left">Price level</th>
                                        <th class="px-2 py-2 text-left">Dates</th>
                                        <th class="px-2 py-2 text-left">Price</th>
                                        <th class="px-2 py-2"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for registration in object.registration_set.all %}
                                        <tr class="{% if registration.has_expired %}bg-yellow-100{% endif %}">
                                            <td class="px-2 py-2">{{ registration.description }}</td>
                                            <td class="px-2 py-2 whitespace-nowrap">{{ registration.reg_date|date }} {% if registration.end_date %} to {{ registration.end_date|date }}{% endif %}</td>
                                            <td class="px-2 py-2">${{ registration.reg_cost }}</td>
                                            <td class="px-2 py-2"><a class="block inline-block py-1 px-2 w-full text-xs font-normal leading-tight text-center text-black no-underline align-middle bg-orange-400 rounded border select-none whitespace-no-wrap hover:bg-orange-500" href="{{ object.reg_url }}">register!</a></td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        {# Mobile card view #}
                        <div class="md:hidden space-y-4">
                            {% for registration in object.registration_set.all %}
                                <div class="border rounded-lg p-4 {% if registration.has_expired %}bg-yellow-100{% else %}bg-white{% endif %}">
                                    <div class="font-bold text-lg mb-2">{{ registration.description }}</div>
                                    <div class="text-sm text-gray-600 mb-2">
                                        {{ registration.reg_date|date }} {% if registration.end_date %} to {{ registration.end_date|date }}{% endif %}
                                    </div>
                                    <div class="text-2xl font-bold text-red-600 mb-3">${{ registration.reg_cost }}</div>
                                    <a class="block py-2 px-4 text-center text-black bg-orange-400 rounded hover:bg-orange-500 transition-colors" href="{{ object.reg_url }}">Register!</a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            {% if object.get_race_news %}
                <section id="news">
                    <h3 class="text-2xl font-bold mb-4">Latest News</h3>
                    {% for item in object.get_race_news|slice:":3" %}
                        <div class="mb-4 prose">{{ item.body|markdownify }}</div>
                    {% endfor %}
                </section>
            {% endif %}

            <section class="flex flex-col divide-y divide-gray-300 py-8 text-xl">
                <div><strong>Race date:</strong> {{ object.start_datetime|date:"F j, Y" }}</div>
                <div><strong>Start time:</strong> {{ object.start_datetime|time:"h:i A" }}</div>
                <div><strong>Race distance:</strong> {{ object.distance }}</div>

                {% if object.cut_off %}
                    <div>Cut off time: {{ object.cut_off }}</div>
                {% endif %}
            </section>

            <section class="prose-lg prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">
                {{ object.description|markdownify }}
            </section>

            <section>
                <h2 class="text-4xl font-bold py-8">Event Information</h2>
            </section>

            <section>
                {% if object.location %}
                    <h3 class="font-bold text-2xl py-4">Location</h3>
                    <div id="map-canvas" class="w-full h-96"></div>
                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ object.location.description|markdownify }}</div>
                {% endif %}

                {% if object.course_map %}
                    <p>Click <a href="{{ object.course_map }}" class="text-red-600 hover:text-red-800 underline">here</a> for a course map.</p>
                {% endif %}
            </section>

            {% if object.awards %}
                <section id="awards">
                    <h3 class="text-2xl font-bold mb-4">Awards</h3>
                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ object.awards|markdownify }}</div>
                </section>
            {% endif %}

            {% if object.race_directors.exists %}
                <section id="rds">
                    <h3 class="text-2xl font-bold mb-4">Race Director{{ object.race_directors.count|pluralize }}</h3>
                    <ul>
                        {% for race_directory in object.race_directors.all %}
                            <li><a href="{% url 'member_detail' pk=race_directory.pk %}" class="text-red-600 hover:text-red-800 underline">{{ race_directory.full_hawk_name }}</a> - <a href="mailto:{{ race_directory.email }}" class="text-red-600 hover:text-red-800 underline">contact</a></li>
                        {% endfor %}
                    </ul>
                </section>
            {% endif %}

            {% if not object.get_overall_results %}
                <section>
                    <h3 class="text-2xl font-bold mb-4">Registration</h3>

                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">
                        {{ object.reg_description|markdownify }}
                    </div>

                    {% if object.entry_form %}
                        <h3 class="text-2xl">Entry Form</h3>
                        <p>Prefer to print and mail in your entry form?</p>
                        <p>Make Checks Payable to: <em>Lawrence Trail Hawks</em></p>
                        <p>Mail to: <br>Lawrence Trail Hawks<br>PO Box 442548<br>Lawrence, KS 66044</p>
                        <p><a class="block inline-block py-1 px-3 w-full font-normal leading-normal text-center text-white no-underline align-middle bg-yellow-500 rounded border select-none whitespace-no-wrap hover:bg-yellow-600" href="{{ object.entry_form.url }}">Download Entry Form</a></p>
                    {% endif %}

                    {% if not object.is_finished %}
                        <hr>
                        <p><a class="block inline-block py-3 px-4 w-full text-xl font-normal leading-tight text-center text-white no-underline align-middle bg-red-600 rounded border select-none whitespace-no-wrap hover:bg-red-700" href="{{ object.reg_url }}">REGISTER TODAY</a></p>
                    {% endif %}

                    {% if object.get_reg_dates %}
                        <p><strong><em>Entry fee:</em></strong></p>
                        <ul>
                            {% for reg in object.get_reg_dates %}
                                <li>${{ reg.reg_cost }} until {{ reg.reg_date|date:"M d" }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}

                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ object.discounts|markdownify }}</div>

                    {% if object.packet_pickup %}
                        <h3 class="text-2xl">Packet Pickup</h3>
                        <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ object.packet_pickup|markdownify }}</div>
                    {% endif %}
                </section>
            {% endif %}

            {% if object.lodging %}
                <hr>
                <h3 class="text-2xl font-bold mb-4">Lodging</h3>
                <p>Lodging information can be found <a href="{{ object.lodging }}" class="text-red-600 hover:text-red-800 underline">here</a>.</p>
            {% endif %}

            {% if object.get_race_reports %}
                {% include "races/includes/race_reports.html" %}
            {% endif %}

            {% if race_types %}
                <section id="results">
                    <h3 class="text-2xl font-bold mb-4">
                        Race Results
                    </h3>
                    <ul>
                        {% for race_type in race_types %}
                            <li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-overallresults" class="text-red-600 hover:text-red-800 underline">{{ race_type.name }} Overall Results</a></li>
                            <li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-mensresults" class="text-red-600 hover:text-red-800 underline">{{ race_type.name }} Men&apos;s Results</a></li>
                            <li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-womensresults" class="text-red-600 hover:text-red-800 underline">{{ race_type.name }} Women&apos;s Results</a></li>
                        {% endfor %}
                    </ul>
                </section>
            {% endif %}

            {# render_facebook_like obj=object #}

            {% get_links_for_object object as link_list %}
            {% if link_list %}
                <hr>
                <h3 class="text-2xl font-bold mb-4">Links</h3>
                {% for link in link_list %}
                    <h4>{{ link.name }}</h4>
                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ link.description|markdownify }}</div>
                {% endfor %}
            {% endif %}


            {% get_faqs_for_object object as faq_list %}
            {% if faq_list %}
                <hr>
                <h3 class="text-2xl font-bold mb-4">Frequently Asked Questions</h3>
                {% for faq in faq_list %}
                    <h4>{{ faq.question }}</h4>
                    <div class="prose prose-a:underline prose-a:text-red-600 hover:prose-a:text-red-800">{{ faq.answer|markdownify }}</div>
                {% endfor %}
            {% endif %}

            {% get_sponsors_for_object object as sponsor_list %}
            {% if sponsor_list %}
                <hr>

                <h3 class="text-2xl font-bold mb-4" id="sponsors">Sponsors</h3>
                <div class="flex flex-auto">
                    {% for sponsor in sponsor_list %}
                        <div class="md:w-1/2">
                            <h3 class="text-2xl"><a href="{{ sponsor.url }}" class="text-red-600 hover:text-red-800 underline">{{ sponsor.name }}</a></h3>
                            {% if sponsor.logo %}
                                <a href="{{ sponsor.url }}" class="hover:opacity-80 transition-opacity">
                                    <img class="w-full h-auto" src="{{ sponsor.logo.url }}" alt="{{ sponsor.name }} logo" />
                                </a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="md:w-1/3">
            <div class="bg-white border border-gray-300 rounded p-4">
                <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                <ul class="flex flex-col space-y-2 list-none">
                    <li><a class="inline-block py-2 px-4 w-full text-center text-white bg-red-600 rounded hover:bg-red-700 transition-colors" href="{{ object.reg_url }}">Register</a></li>
                    {% if object.get_race_news %}
                        <li><a href="#news" class="text-red-600 hover:text-red-800 hover:underline">News</a></li>
                    {% endif %}
                    {% if object.awards %}
                        <li><a href="#awards" class="text-red-600 hover:text-red-800 hover:underline">Awards</a></li>
                    {% endif %}
                    {% if object.race_directors.exists %}
                        <li><a href="#rds" class="text-red-600 hover:text-red-800 hover:underline">Race Directors</a></li>
                    {% endif %}
                    {% if race_types %}
                        <li><a href="#results" class="text-red-600 hover:text-red-800 hover:underline">Results</a></li>
                    {% endif %}
                    {% if object.sponsors.exists %}
                        <li><a href="#sponsors" class="text-red-600 hover:text-red-800 hover:underline">Sponsors</a></li>
                    {% endif %}
                </ul>
            </div>

            {% if object.get_overall_results %}
                <div class="bg-white border border-gray-300 rounded">
                    <div class="bg-gray-50 px-4 py-2 border-b border-gray-300">
                        <h3 class="text-2xl font-bold">Race Results</h3>
                    </div>
                    <ul class="flex flex-col pl-0 mb-0">
                        {% for race_type in race_types %}
                            <li class="py-2 px-4"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-overallresults" class="text-red-600 hover:text-red-800 hover:underline">{{ race_type.name }} Overall Results</a></li>
                            <li class="py-2 px-4"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-mensresults" class="text-red-600 hover:text-red-800 hover:underline">{{ race_type.name }} Men&apos;s Results</a></li>
                            <li class="py-2 px-4"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-womensresults" class="text-red-600 hover:text-red-800 hover:underline">{{ race_type.name }} Women&apos;s Results</a></li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {# include "panels/photos.html" with photos=photos_list #}
        </div>
    </div>
{% endblock content %}
