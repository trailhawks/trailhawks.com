{% extends base_template_name|default:"base.html" %}

{# Demo A: "Carousel + Side-by-Side" #}
{# Carousel stays prominent, runs and next race shown equally below #}

{% load blog_tags %}
{% load cache %}
{% load core_tags %}
{% load heroicons %}
{% load markdownify %}
{% load news_tags %}
{% load race_tags %}
{% load run_tags %}
{% load sponsors_tags %}
{% load static %}
{% load thumbor_tags %}


{% block content %}
    {# Photo Carousel #}
    <section class="w-full">
        {% include 'includes/_carousel.html' %}
    </section>

    {# Weekly Runs + Next Race Side-by-Side #}
    <section class="flex flex-col lg:flex-row gap-8">
        {# Weekly Runs - Left Half #}
        <div class="w-full lg:w-1/2">
            <h2 class="font-bold text-2xl md:text-3xl pb-4">Weekly Runs</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                {% for run in runs %}
                    {% include 'includes/_run_card.html' with run=run %}
                {% empty %}
                    <p class="text-gray-500 col-span-full">No weekly runs scheduled.</p>
                {% endfor %}
            </div>
            <a class="inline-block mt-4 py-2 px-4 text-sm font-medium text-red-600 hover:text-red-800 transition-colors" href="{% url 'run_list' %}">
                View all runs <i class="fa fa-arrow-right ml-1"></i>
            </a>
        </div>

        {# Next Race - Right Half #}
        <div class="w-full lg:w-1/2">
            {% get_latest_race as latest_race %}
            {% if latest_race %}
                <h2 class="font-bold text-2xl md:text-3xl pb-4">Next Event</h2>
                <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                    {% if latest_race.logo %}
                        <a href="{{ latest_race.get_absolute_url }}" class="block">
                            <img class="w-full h-48 object-contain bg-gray-50 p-4" src="{{ latest_race.logo.url }}" alt="{{ latest_race.title }} logo">
                        </a>
                    {% endif %}
                    <div class="p-4 md:p-6">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="inline-block px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded">
                                {{ latest_race.start_datetime|date:"M j, Y" }}
                            </span>
                            <span class="text-sm text-gray-500">{{ latest_race.distance }} {{ latest_race.get_unit_display }}</span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">
                            <a href="{{ latest_race.get_absolute_url }}" class="text-gray-900 hover:text-red-600 transition-colors">{{ latest_race.title }}</a>
                        </h3>
                        {% if latest_race.slogan %}
                            <p class="text-gray-600 italic mb-4">{{ latest_race.slogan }}</p>
                        {% endif %}
                        <a class="inline-block py-2 px-4 w-full font-medium text-center text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors" href="{{ latest_race.get_absolute_url }}">
                            Learn more <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            {% else %}
                <h2 class="font-bold text-2xl md:text-3xl pb-4">Latest Post</h2>
                {% if latest_post %}
                    <article class="bg-white border border-gray-200 rounded-lg shadow-sm p-4 md:p-6">
                        <h3 class="font-bold text-xl mb-2">
                            <a href="{{ latest_post.get_absolute_url }}" class="text-gray-900 hover:text-red-600 transition-colors">{{ latest_post.title }}</a>
                        </h3>
                        <p class="text-gray-500 text-sm mb-4">{{ latest_post.publish|date:"M j, Y" }}</p>
                        <div class="prose prose-sm">
                            {{ latest_post.body|markdownify|truncatewords_html:100 }}
                        </div>
                    </article>
                {% endif %}
            {% endif %}
        </div>
    </section>

    {# Upcoming Races Grid #}
    <section id="upcoming-races">
        <h2 class="font-bold text-2xl md:text-3xl pb-4">Upcoming Races</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
            {% get_latest_races as races %}
            {% for race in races %}
                {% include 'includes/_race.html' with race=race %}
            {% empty %}
                <p class="text-gray-500 col-span-full">No upcoming races scheduled.</p>
            {% endfor %}
        </div>
        <a class="inline-block mt-4 py-2 px-4 text-sm font-medium text-red-600 hover:text-red-800 transition-colors" href="{% url 'race_index' %}">
            View all races <i class="fa fa-arrow-right ml-1"></i>
        </a>
    </section>

    {# Recent News Grid #}
    <section id="recent-news">
        <h2 class="font-bold text-2xl md:text-3xl pb-4">Recent News</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% get_latest_news num=6 as latest_news %}
            {% for news in latest_news %}
                {% include 'includes/_news_card.html' with news=news %}
            {% empty %}
                <p class="text-gray-500 col-span-full">No recent news.</p>
            {% endfor %}
        </div>
        <a class="inline-block mt-4 py-2 px-4 text-sm font-medium text-red-600 hover:text-red-800 transition-colors" href="{% url 'news_list' %}">
            View all news <i class="fa fa-arrow-right ml-1"></i>
        </a>
    </section>

    {# Sponsors #}
    {% get_homepage_sponsors as homepage_sponsors %}
    {% if homepage_sponsors %}
        <section id="sponsors">
            <h2 class="font-bold text-2xl md:text-3xl pb-4">Sponsors</h2>
            <div class="flex flex-wrap -mx-2">
                {% for sponsor in homepage_sponsors %}
                    {% include 'includes/_sponsor.html' with sponsor=sponsor %}
                {% endfor %}
            </div>
        </section>
    {% endif %}
{% endblock content %}
