{% extends base_template_name|default:"base.html" %}

{% load blog_tags %}
{% load cache %}
{% load core_tags %}
{% load heroicons %}
{% load markdownify %}
{% load members_tags %}
{% load news_tags %}
{% load race_tags %}
{% load run_tags %}
{% load sponsors_tags %}
{% load static %}
{% load thumbor_tags %}


{% block content %}
    {% get_latest_races as races %}
    {% get_past_races as past_races %}
    {% get_homepage_sponsors as homepage_sponsors %}
    {% get_active_members as active_members %}

    {# Hero Carousel #}
    <section class="w-full -mx-4 md:-mx-6 -mt-4 md:-mt-6 mb-8">
        <div class="px-4 md:px-6">
            {% include 'includes/_carousel.html' %}
        </div>
    </section>

    {# Quick Stats Bar #}
    <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-gradient-to-br from-red-600 to-red-700 rounded-xl p-4 text-white text-center">
            <div class="text-3xl md:text-4xl font-bold">{{ races.count }}</div>
            <div class="text-red-200 text-sm">Upcoming Races</div>
        </div>
        <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-4 text-white text-center">
            <div class="text-3xl md:text-4xl font-bold">{{ runs|length }}</div>
            <div class="text-green-200 text-sm">Weekly Runs</div>
        </div>
        <div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-4 text-white text-center">
            <div class="text-3xl md:text-4xl font-bold">{{ active_members.count }}</div>
            <div class="text-blue-200 text-sm">Active Members</div>
        </div>
        <div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-4 text-white text-center">
            <div class="text-3xl md:text-4xl font-bold">{{ past_races.count }}</div>
            <div class="text-purple-200 text-sm">Races Organized</div>
        </div>
    </section>

    {# Three-Column Dashboard: Runs | Races | News #}
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 mb-12">
        {# Column 1: Weekly Runs #}
        <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
            <div class="bg-gradient-to-r from-green-600 to-green-700 px-4 py-3">
                <h2 class="font-bold text-lg text-white flex items-center gap-2">
                    <i class="fa fa-running"></i>
                    Weekly Runs
                </h2>
            </div>
            <div class="p-4 space-y-3">
                {% for run in runs %}
                    <a href="{{ run.get_absolute_url }}" class="block p-3 bg-gray-50 rounded-lg hover:bg-green-50 hover:border-green-300 border border-transparent transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-gray-900 group-hover:text-green-700">{{ run.get_day_of_week_display }}s</span>
                            {% if run.run_time %}
                                <span class="text-sm text-gray-500 bg-white px-2 py-0.5 rounded">{{ run.run_time }}</span>
                            {% endif %}
                        </div>
                        <p class="text-sm text-green-600 mt-1 font-medium">{{ run.name }}</p>
                        {% if run.location %}
                            <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                                <i class="fa fa-map-marker-alt"></i>{{ run.location }}
                            </p>
                        {% endif %}
                    </a>
                {% empty %}
                    <p class="text-gray-500 text-sm p-3">No weekly runs scheduled.</p>
                {% endfor %}
            </div>
            <div class="px-4 pb-4">
                <a href="{% url 'run_list' %}" class="block w-full py-2 px-4 bg-green-600 hover:bg-green-700 text-white text-center font-semibold rounded-lg transition-colors">
                    View All Runs <i class="fa fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>

        {# Column 2: Upcoming Races #}
        <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-4 py-3">
                <h2 class="font-bold text-lg text-white flex items-center gap-2">
                    <i class="fa fa-flag-checkered"></i>
                    Upcoming Races
                </h2>
            </div>
            <div class="p-4 space-y-3">
                {% for race in races|slice:":4" %}
                    <a href="{{ race.get_absolute_url }}" class="block p-3 bg-gray-50 rounded-lg hover:bg-red-50 border border-transparent hover:border-red-300 transition-all group">
                        <div class="flex items-center gap-3">
                            {% if race.logo %}
                                <img class="w-12 h-12 object-contain rounded bg-white p-1 border border-gray-200" src="{{ race.logo.url }}" alt="">
                            {% else %}
                                <div class="w-12 h-12 bg-red-100 rounded flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-trophy text-red-600"></i>
                                </div>
                            {% endif %}
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-gray-900 group-hover:text-red-700 truncate">{{ race.title }}</p>
                                <p class="text-sm text-gray-500 flex items-center gap-1">
                                    <i class="fa fa-calendar-alt text-xs"></i>
                                    {{ race.start_datetime|date:"M j, Y" }}
                                </p>
                            </div>
                        </div>
                    </a>
                {% empty %}
                    <p class="text-gray-500 text-sm p-3">No upcoming races.</p>
                {% endfor %}
            </div>
            <div class="px-4 pb-4">
                <a href="{% url 'race_index' %}" class="block w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white text-center font-semibold rounded-lg transition-colors">
                    View All Races <i class="fa fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>

        {# Column 3: Recent News #}
        <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3">
                <h2 class="font-bold text-lg text-white flex items-center gap-2">
                    <i class="fa fa-newspaper"></i>
                    Recent News
                </h2>
            </div>
            <div class="p-4 space-y-3">
                {% get_latest_news num=4 as latest_news %}
                {% for news in latest_news %}
                    <article class="p-3 bg-gray-50 rounded-lg hover:bg-blue-50 border border-transparent hover:border-blue-300 transition-all">
                        <div class="flex items-center gap-2 text-xs text-gray-500 mb-1">
                            <i class="fa fa-calendar-alt"></i>
                            {{ news.pub_date|date:"M j, Y" }}
                        </div>
                        {% if news.title %}
                            <h4 class="font-semibold text-gray-900 text-sm mb-1 line-clamp-1">{{ news.title }}</h4>
                        {% endif %}
                        <div class="prose prose-sm text-gray-600 text-xs line-clamp-2">
                            {{ news.body|markdownify|truncatewords_html:20 }}
                        </div>
                    </article>
                {% empty %}
                    <p class="text-gray-500 text-sm p-3">No recent news.</p>
                {% endfor %}
            </div>
            <div class="px-4 pb-4">
                <a href="{% url 'news_list' %}" class="block w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white text-center font-semibold rounded-lg transition-colors">
                    View All News <i class="fa fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </section>

    {# Sponsors Section #}
    {% if homepage_sponsors %}
        <section id="sponsors" class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-12">
            <div class="bg-gradient-to-r from-pink-600 to-pink-700 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                    <i class="fa fa-handshake"></i>
                    Our Sponsors
                </h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    {% for sponsor in homepage_sponsors %}
                        {% if sponsor.logo %}
                            <a href="{{ sponsor.url }}" class="group block p-3 bg-gray-50 rounded-lg hover:bg-pink-50 border border-transparent hover:border-pink-300 transition-all" target="_blank" rel="noopener">
                                <img class="w-full h-16 object-contain group-hover:scale-105 transition-transform" src="{{ sponsor.logo.url }}" alt="{{ sponsor.name }}">
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="mt-4 text-center">
                    <a href="{% url 'sponsor_list' %}" class="inline-block text-sm font-medium text-pink-600 hover:text-pink-800 transition-colors">
                        View All Sponsors <i class="fa fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </section>
    {% endif %}

    {# About Trail Hawks #}
    <section class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-12">
        <div class="bg-gradient-to-r from-red-800 to-red-900 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-2">
                <i class="fa fa-users"></i>
                About the Trail Hawks
            </h2>
        </div>
        <div class="p-6">
            <div class="flex flex-col md:flex-row gap-8 items-center">
                <div class="flex-shrink-0">
                    <img src="{% static 'img/hawk-head.png' %}" alt="Trail Hawks Logo" class="w-32 h-32 md:w-48 md:h-48">
                </div>
                <div class="flex-grow">
                    <p class="text-lg text-gray-700 mb-4">
                        The Lawrence Trail Hawks are a community of trail runners based in Lawrence, Kansas. We organize weekly group runs, put on trail races throughout the year, and foster a welcoming environment for runners of all abilities.
                    </p>
                    <p class="text-gray-600 mb-6">
                        Whether you're training for your first 5K or your next ultramarathon, you'll find a supportive community here. Join us on the trails!
                    </p>
                    <div class="flex flex-wrap gap-3">
                        <a href="/signup/" class="inline-flex items-center gap-2 px-6 py-3 bg-yellow-400 hover:bg-yellow-500 text-red-900 font-bold rounded-lg transition-colors">
                            <i class="fa fa-plus-circle"></i>
                            Join the Hawks
                        </a>
                        <a href="{% url 'about' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg transition-colors">
                            <i class="fa fa-info-circle"></i>
                            Learn More
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {# Featured Race - Next Upcoming #}
    {% if races %}
        {% with races.first as featured_race %}
            <section class="bg-gradient-to-br from-red-900 via-red-800 to-red-900 rounded-xl shadow-lg overflow-hidden mb-12 text-white">
                <div class="p-6 md:p-8">
                    <div class="flex flex-col md:flex-row items-center gap-6 md:gap-10">
                        {% if featured_race.logo %}
                            <div class="flex-shrink-0">
                                <img class="w-32 h-32 md:w-40 md:h-40 object-contain bg-white rounded-lg p-2 shadow-lg" src="{{ featured_race.logo.url }}" alt="{{ featured_race.title }} logo">
                            </div>
                        {% endif %}
                        <div class="text-center md:text-left flex-grow">
                            <div class="text-red-300 text-sm font-semibold uppercase tracking-wider mb-2">Featured Race</div>
                            <h3 class="font-bold text-2xl md:text-3xl lg:text-4xl mb-2">{{ featured_race.title }}</h3>
                            {% if featured_race.slogan %}
                                <p class="text-red-200 mb-4">{{ featured_race.slogan }}</p>
                            {% endif %}
                            <div class="flex flex-wrap justify-center md:justify-start gap-3 mb-6">
                                <span class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full text-sm">
                                    <i class="fa fa-calendar"></i>
                                    {{ featured_race.start_datetime|date:"F j, Y" }}
                                </span>
                                <span class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full text-sm">
                                    <i class="fa fa-clock"></i>
                                    {{ featured_race.start_datetime|time:"g:i A" }}
                                </span>
                                <span class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full text-sm">
                                    <i class="fa fa-route"></i>
                                    {{ featured_race.distance }}
                                </span>
                            </div>
                            <div class="flex flex-wrap justify-center md:justify-start gap-3">
                                {% if featured_race.reg_url %}
                                    <a href="{{ featured_race.reg_url }}" class="inline-flex items-center gap-2 px-6 py-3 bg-yellow-400 hover:bg-yellow-300 text-red-900 font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                                        <i class="fa fa-ticket-alt"></i>
                                        Register Now
                                    </a>
                                {% endif %}
                                <a href="{{ featured_race.get_absolute_url }}" class="inline-flex items-center gap-2 px-6 py-3 bg-white/20 hover:bg-white/30 text-white font-semibold rounded-lg transition-colors">
                                    <i class="fa fa-info-circle"></i>
                                    Race Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        {% endwith %}
    {% endif %}

    {# Latest Blog Posts #}
    {% get_latest_posts num=3 as latest_posts %}
    {% if latest_posts %}
        <section class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-12">
            <div class="bg-gradient-to-r from-indigo-600 to-indigo-700 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                    <i class="fa fa-blog"></i>
                    From the Blog
                </h2>
            </div>
            <div class="p-6">
                <div class="grid md:grid-cols-3 gap-6">
                    {% for post in latest_posts %}
                        <article class="group">
                            <a href="{{ post.get_absolute_url }}" class="block">
                                {% if post.hero_image %}
                                    <img class="w-full h-40 object-cover rounded-lg mb-3 group-hover:shadow-md transition-shadow" src="{{ post.hero_image.url }}" alt="">
                                {% else %}
                                    <div class="w-full h-40 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-lg mb-3 flex items-center justify-center group-hover:shadow-md transition-shadow">
                                        <i class="fa fa-feather-alt text-4xl text-indigo-400"></i>
                                    </div>
                                {% endif %}
                                <div class="text-xs text-gray-500 mb-1 flex items-center gap-2">
                                    <i class="fa fa-calendar-alt"></i>
                                    {{ post.pub_date|date:"M j, Y" }}
                                </div>
                                <h3 class="font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors line-clamp-2">{{ post.title }}</h3>
                            </a>
                        </article>
                    {% endfor %}
                </div>
                <div class="mt-6 text-center">
                    <a href="{% url 'blog_list' %}" class="inline-flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors">
                        View All Posts <i class="fa fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </section>
    {% endif %}

    {# Why Join / Benefits #}
    <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-900 mb-8">Why Run With Us?</h2>
        <div class="grid md:grid-cols-3 gap-6">
            <div class="bg-white border border-gray-200 rounded-xl p-6 text-center hover:shadow-lg transition-shadow">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-users text-2xl text-green-600"></i>
                </div>
                <h3 class="font-bold text-lg text-gray-900 mb-2">Welcoming Community</h3>
                <p class="text-gray-600 text-sm">Runners of all abilities are welcome. From beginners to ultramarathoners, everyone finds their place here.</p>
            </div>
            <div class="bg-white border border-gray-200 rounded-xl p-6 text-center hover:shadow-lg transition-shadow">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-calendar-check text-2xl text-blue-600"></i>
                </div>
                <h3 class="font-bold text-lg text-gray-900 mb-2">Regular Group Runs</h3>
                <p class="text-gray-600 text-sm">Multiple weekly runs at various times and locations. Find a group that fits your schedule.</p>
            </div>
            <div class="bg-white border border-gray-200 rounded-xl p-6 text-center hover:shadow-lg transition-shadow">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-medal text-2xl text-red-600"></i>
                </div>
                <h3 class="font-bold text-lg text-gray-900 mb-2">Amazing Trail Races</h3>
                <p class="text-gray-600 text-sm">We organize some of the best trail races in Kansas, from fun 5Ks to challenging 100-milers.</p>
            </div>
        </div>
    </section>

    {# Call to Action #}
    <section class="bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl shadow-lg p-8 md:p-12 text-center mb-8">
        <div class="max-w-2xl mx-auto">
            <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa fa-running text-4xl text-yellow-900"></i>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold text-yellow-900 mb-4">Ready to Hit the Trails?</h2>
            <p class="text-yellow-800 text-lg mb-6">Join the Lawrence Trail Hawks today and become part of our amazing running community. Your next adventure awaits!</p>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="/signup/" class="inline-flex items-center gap-2 px-8 py-4 bg-yellow-900 hover:bg-yellow-800 text-white font-bold text-lg rounded-lg transition-colors shadow-lg">
                    <i class="fa fa-plus-circle"></i>
                    Become a Member
                </a>
                <a href="/contact/" class="inline-flex items-center gap-2 px-8 py-4 bg-white hover:bg-gray-100 text-yellow-900 font-semibold text-lg rounded-lg transition-colors">
                    <i class="fa fa-envelope"></i>
                    Contact Us
                </a>
            </div>
        </div>
    </section>
{% endblock content %}
